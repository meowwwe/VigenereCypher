<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Combined Classical Cryptography</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    textarea, input, button { font-size: 1rem; margin: 0.5rem 0; width: 100%; }
    #logs { white-space: pre-wrap; background: #f0f0f0; padding: 1rem; height: 200px; overflow-y: auto; }
    button { width: auto; padding: 0.5rem 1rem; margin-right: 1rem; }
    #result { margin-top: 1rem; font-weight: bold; }
  </style>
</head>
<body>

  <h1>Combined Classical Cryptography System</h1>

  <label for="messageInput">Message / Cipher Text:</label>
  <textarea id="messageInput" rows="3"></textarea>

  <label for="keyInput">Key:</label>
  <input type="text" id="keyInput" />

  <div>
    <button onclick="onEncryptClicked()">Encrypt</button>
    <button onclick="onDecryptClicked()">Decrypt</button>
  </div>

  <h3 id="result"></h3>

  <script>
    function generateVigenereTable() {
      let table = [];
      for (let i = 0; i < 26; i++) {
        let row = [];
        for (let j = 0; j < 26; j++) {
          row.push(String.fromCharCode(((i + j) % 26) + 65));
        }
        table.push(row);
      }
      return table;
    }

    function repeatKey(message, key) {
      let fullKey = '';
      for (let i = 0; i < message.length; i++) {
        fullKey += key[i % key.length];
      }
      return fullKey;
    }

    function vigenereEncrypt(message, key) {
      let result = '';
      for (let i = 0; i < message.length; i++) {
        const m = message.charCodeAt(i) - 32;
        const k = key.charCodeAt(i % key.length) - 32;
        result += String.fromCharCode(((m + k) % 95) + 32);
      }
      return result;
    }

    function vigenereDecrypt(cipher, key) {
      let result = '';
      for (let i = 0; i < cipher.length; i++) {
        const c = cipher.charCodeAt(i) - 32;
        const k = key.charCodeAt(i % key.length) - 32;
        result += String.fromCharCode(((c - k + 95) % 95) + 32);
      }
      return result;
    }

    function asciiEncrypt(message, key) {
      let result = '';
      for (let i = 0; i < message.length; i++) {
        const m = message.charCodeAt(i) - 32;
        const k = key.charCodeAt(i % key.length) - 32;
        result += String.fromCharCode(((m + k) % 95) + 32);
      }
      return result;
    }

    function asciiDecrypt(cipher, key) {
      let result = '';
      for (let i = 0; i < cipher.length; i++) {
        const c = cipher.charCodeAt(i) - 32;
        const k = key.charCodeAt(i % key.length) - 32;
        result += String.fromCharCode(((c - k + 95) % 95) + 32);
      }
      return result;
    }

    function confuseKey(originalKey) {
      let confused = '';
      for (let i = 0; i < originalKey.length; i++) {
        confused += String.fromCharCode((originalKey.charCodeAt(i) + 1) % 127);
      }
      return confused;
    }

    function deconfuseKey(confusedKey) {
      let original = '';
      for (let i = 0; i < confusedKey.length; i++) {
        original += String.fromCharCode((confusedKey.charCodeAt(i) - 1 + 127) % 127);
      }
      return original;
    }

    function diffuseText(text) {
      return text.split('').reverse().join('');
    }

    function reverseDiffuseText(text) {
      return text.split('').reverse().join('');
    }

    function combinedEncryptWithSteps(message, key) {
      let logs = [];
      logs.push(`Original Message: "${message}"`);
      logs.push(`Original Key: "${key}"`);

      const confusedKey = confuseKey(key);
      logs.push(`Confused Key (+1 ASCII): "${confusedKey}"`);

      const step1 = vigenereEncrypt(message, confusedKey);
      logs.push(`Step 1 - Vigenère Encrypt (A–Z only): "${step1}"`);

      const step2 = asciiEncrypt(step1, confusedKey);
      logs.push(`Step 2 - ASCII Encrypt: "${step2}"`);

      const step3 = diffuseText(step2);
      logs.push(`Step 3 - Diffusion (Reverse): "${step3}"`);

      return { result: step3, logs };
    }

    function combinedDecryptWithSteps(cipher, key) {
      let logs = [];
      logs.push(`Cipher Text: "${cipher}"`);
      logs.push(`Original Key: "${key}"`);

      const confusedKey = confuseKey(key);
      logs.push(`Confused Key (+1 ASCII): "${confusedKey}"`);

      const step1 = reverseDiffuseText(cipher);
      logs.push(`Step 1 - Reverse Diffusion: "${step1}"`);

      const step2 = asciiDecrypt(step1, confusedKey);
      logs.push(`Step 2 - ASCII Decrypt: "${step2}"`);

      const step3 = vigenereDecrypt(step2, confusedKey);
      logs.push(`Step 3 - Vigenère Decrypt (A–Z only): "${step3}"`);

      return { result: step3, logs };
    }

    function onEncryptClicked() {
      const message = document.getElementById('messageInput').value;
      const key = document.getElementById('keyInput').value;

      if (!message || !key) {
        alert('Please enter both message and key.');
        return;
      }

      const { result } = combinedEncryptWithSteps(message, key);
      document.getElementById('result').textContent = `Encrypted Text: ${result}`;
    }

    function onDecryptClicked() {
      const cipher = document.getElementById('messageInput').value;
      const key = document.getElementById('keyInput').value;

      if (!cipher || !key) {
        alert('Please enter both cipher text and key.');
        return;
      }

      const { result } = combinedDecryptWithSteps(cipher, key);
      document.getElementById('result').textContent = `Decrypted Text: ${result}`;
    }
  </script>
</body>
</html>
